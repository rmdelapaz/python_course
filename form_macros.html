<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Macros for Reusable Components</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="icon" href="/favicon.png">
</head>
<body>
    <header>
        <h1>Form Macros for Reusable Components</h1>
        <p class="subtitle">Python Web Development with Flask</p>
    </header>

    <main>
        <section>
            <h2>Introduction to Form Macros</h2>
            <p>In web development, particularly when working with Python and Flask, creating consistent, maintainable forms is essential for a good user experience. Form macros provide a powerful way to create reusable components that standardize your form design and reduce code duplication.</p>
            
            <p>Think of macros like cookie cutters for your forms. Instead of hand-shaping every cookie (form element), you use the same cutter (macro) to ensure consistency while still allowing for customization (via parameters).</p>
            
            <p>As your application grows, you'll likely create dozens of forms with similar patterns. Without macros, you end up copying and pasting HTML, which leads to several problems:</p>
            <ul>
                <li><strong>Code duplication</strong>: Changes need to be made in multiple places</li>
                <li><strong>Inconsistent styling</strong>: Forms look different across your application</li>
                <li><strong>Maintenance challenges</strong>: Bug fixes and improvements become tedious</li>
            </ul>
            
            <p>Form macros solve these problems by centralizing your form component definitions. In Jinja2 (Flask's templating engine), macros function similar to functions in programming - they accept parameters and return HTML.</p>
        </section>

        <section>
            <h2>Creating Your First Form Macros</h2>
            <p>Let's start by creating a file specifically for our form macros. This is typically placed in a <code>templates/macros</code> folder structure:</p>
            
            <pre><code>app/
├── templates/
│   ├── macros/
│   │   ├── forms.html       # Our form macros
│   ├── base.html
│   ├── contact.html
│   ├── ...
</code></pre>
            
            <p>Now, let's create our <code>forms.html</code> macro file with basic form field rendering:</p>
            
            <pre><code>{# app/templates/macros/forms.html #}

{% macro render_field(field, label_class='', field_class='form-control') %}
    &lt;div class="form-group"&gt;
        {{ field.label(class=label_class) }}
        
        {% if field.type == 'BooleanField' %}
            &lt;div class="form-check"&gt;
                {{ field(class='form-check-input ' + field_class) }}
                {{ field.label(class='form-check-label ' + label_class) }}
            &lt;/div&gt;
        {% else %}
            {{ field(class=field_class) }}
        {% endif %}
        
        {% if field.errors %}
            {% for error in field.errors %}
                &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
            {% endfor %}
        {% endif %}
        
        {% if field.description %}
            &lt;small class="form-text text-muted"&gt;{{ field.description }}&lt;/small&gt;
        {% endif %}
    &lt;/div&gt;
{% endmacro %}

{% macro render_submit(field, class='btn btn-primary') %}
    &lt;div class="form-group mt-3"&gt;
        {{ field(class=class) }}
    &lt;/div&gt;
{% endmacro %}

{% macro render_form(form, action='', method='post', enctype=None) %}
    &lt;form action="{{ action }}" method="{{ method }}" {% if enctype %}enctype="{{ enctype }}"{% endif %} novalidate&gt;
        {{ form.hidden_tag() }}
        
        {% for field in form %}
            {% if field.type != 'CSRFTokenField' and field.type != 'SubmitField' %}
                {{ render_field(field) }}
            {% endif %}
        {% endfor %}
        
        {% for field in form %}
            {% if field.type == 'SubmitField' %}
                {{ render_submit(field) }}
            {% endif %}
        {% endfor %}
    &lt;/form&gt;
{% endmacro %}</code></pre>
            
            <p>Here we've created three macros:</p>
            <ul>
                <li><code>render_field</code>: Renders an individual form field with label, errors, and description</li>
                <li><code>render_submit</code>: Renders a submit button</li>
                <li><code>render_form</code>: Renders an entire form with all its fields</li>
            </ul>
        </section>

        <section>
            <h2>Using Form Macros</h2>
            <p>Now that we've created our macros, let's see how to use them in a template:</p>
            
            <pre><code>{# app/templates/contact.html #}
{% extends 'base.html' %}
{% from 'macros/forms.html' import render_field, render_submit, render_form %}

{% block title %}Contact Us{% endblock %}

{% block content %}
    &lt;h2&gt;Contact Us&lt;/h2&gt;
    
    {# Method 1: Render individual fields #}
    &lt;form method="post" novalidate&gt;
        {{ form.hidden_tag() }}
        
        {{ render_field(form.name) }}
        {{ render_field(form.email) }}
        {{ render_field(form.subject) }}
        {{ render_field(form.message, field_class='form-control textarea-autosize') }}
        
        {{ render_submit(form.submit) }}
    &lt;/form&gt;
    
    {# OR #}
    
    {# Method 2: Render the entire form #}
    {# {{ render_form(form) }} #}
{% endblock %}</code></pre>
            
            <p>This complex multi-step checkout form becomes much more manageable with form macros. Each component is reusable and consistent, dramatically reducing the amount of HTML you need to write and maintain.</p>
        </section>

        <section>
            <h2>JavaScript Integration with Form Macros</h2>
            <p>Form macros work excellently with JavaScript to create dynamic interactions. Here's an example of JavaScript that might accompany our checkout form:</p>
            
            <pre><code>// app/static/js/checkout.js
document.addEventListener('DOMContentLoaded', function() {
    // Step navigation
    const steps = document.querySelectorAll('.checkout-step');
    const nextButtons = document.querySelectorAll('.next-step');
    const prevButtons = document.querySelectorAll('.prev-step');
    const progressBar = document.querySelector('.progress-bar');
    
    let currentStepIndex = 0;
    
    function showStep(index) {
        // Hide all steps
        steps.forEach(step => {
            step.classList.remove('active');
        });
        
        // Show current step
        steps[index].classList.add('active');
        
        // Update progress bar
        const progress = ((index + 1) / steps.length) * 100;
        progressBar.style.width = `${progress}%`;
        progressBar.setAttribute('aria-valuenow', progress);
        progressBar.textContent = `Step ${index + 1} of ${steps.length}`;
        
        // Update step indicators
        document.querySelectorAll('.step').forEach((indicator, i) => {
            if (i === index) {
                indicator.classList.add('active');
            } else {
                indicator.classList.remove('active');
            }
        });
    }
    
    // Setup next buttons
    nextButtons.forEach(button => {
        button.addEventListener('click', () => {
            // You might add validation here
            if (validateStep(currentStepIndex)) {
                currentStepIndex++;
                showStep(currentStepIndex);
                window.scrollTo(0, 0);
            }
        });
    });
    
    // Setup previous buttons
    prevButtons.forEach(button => {
        button.addEventListener('click', () => {
            currentStepIndex--;
            showStep(currentStepIndex);
            window.scrollTo(0, 0);
        });
    });
    
    // Function to validate current step
    function validateStep(stepIndex) {
        // Add validation logic here
        return true;
    }
    
    // Payment method toggle
    const paymentMethodRadios = document.querySelectorAll('input[name="payment_method"]');
    const paymentFields = document.querySelectorAll('.payment-fields');
    
    paymentMethodRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            paymentFields.forEach(field => {
                field.style.display = 'none';
            });
            
            const value = radio.value;
            document.getElementById(`${value}-fields`).style.display = 'block';
        });
    });
    
    // Same as shipping checkbox
    const sameAsShippingCheckbox = document.getElementById('same_as_shipping');
    const billingAddressContainer = document.getElementById('billing-address-container');
    
    sameAsShippingCheckbox.addEventListener('change', () => {
        if (sameAsShippingCheckbox.checked) {
            billingAddressContainer.style.display = 'none';
            
            // Copy shipping address values to billing
            document.querySelectorAll('[id^="shipping_"]').forEach(field => {
                const billingId = field.id.replace('shipping_', 'billing_');
                const billingField = document.getElementById(billingId);
                
                if (billingField) {
                    billingField.value = field.value;
                }
            });
        } else {
            billingAddressContainer.style.display = 'block';
        }
    });
    
    // Create account checkbox
    const createAccountCheckbox = document.getElementById('create_account');
    const passwordFields = document.getElementById('password-fields');
    
    if (createAccountCheckbox) {
        createAccountCheckbox.addEventListener('change', () => {
            passwordFields.style.display = createAccountCheckbox.checked ? 'block' : 'none';
        });
    }
});
</code></pre>
        </section>
        
        <section>
            <h2>Benefits of Form Macros</h2>
            <p>Using form macros in your Flask applications offers numerous benefits:</p>
            
            <ul>
                <li><strong>Consistency</strong>: All forms across your application look and behave consistently</li>
                <li><strong>Maintainability</strong>: Make changes in one place and they propagate everywhere</li>
                <li><strong>Productivity</strong>: Write less HTML and focus more on application logic</li>
                <li><strong>Flexibility</strong>: Accept parameters to customize behavior when needed</li>
                <li><strong>Scalability</strong>: Handle complex form patterns with ease</li>
            </ul>
            
            <p>Think of form macros as a design system for your forms - they establish standards and patterns that make development faster and more consistent.</p>
            
            <h3>Form Macros vs. Flask-WTF Fields</h3>
            <p>It's important to understand that form macros work alongside Flask-WTF, not as a replacement. Flask-WTF handles:</p>
            
            <ul>
                <li>Form definition and structure</li>
                <li>Validation logic</li>
                <li>CSRF protection</li>
            </ul>
            
            <p>While form macros handle:</p>
            
            <ul>
                <li>HTML rendering</li>
                <li>Layout and styling</li>
                <li>Error message display</li>
                <li>Consistent UX patterns</li>
            </ul>
            
            <p>This separation of concerns is powerful - your Python code handles the "what" (validation, structure) while your macros handle the "how" (presentation, interaction).</p>
        </section>
        
        <section>
            <h2>Form Macros in Complex Applications</h2>
            <p>In larger applications, you might extend this concept further:</p>
            
            <h3>Macro Libraries</h3>
            <p>Create separate macro files for different types of components:</p>
            <ul>
                <li><code>forms.html</code> - Basic form controls</li>
                <li><code>layout.html</code> - Grid and structural macros</li>
                <li><code>components.html</code> - Complex UI components</li>
            </ul>
            
            <p>You could organize them in a folder structure like this:</p>
            
            <pre><code>app/
├── templates/
│   ├── macros/
│   │   ├── forms.html
│   │   ├── layout.html
│   │   ├── components.html
│   │   └── ...
│   ├── base.html
│   └── ...
</code></pre>
            
            <h3>Theme Support</h3>
            <p>You can also parameterize your macros to support different visual themes:</p>
            
            <pre><code>{% macro render_field(field, theme='default', label_class='', field_class='form-control') %}
    {% if theme == 'compact' %}
        &lt;div class="form-group form-group-sm"&gt;
            {{ field.label(class='form-label-sm ' + label_class) }}
            {{ field(class='form-control-sm ' + field_class) }}
        &lt;/div&gt;
    {% elif theme == 'dark' %}
        &lt;div class="form-group bg-dark text-light p-3 rounded"&gt;
            {{ field.label(class='text-light ' + label_class) }}
            {{ field(class='form-control bg-secondary text-light ' + field_class) }}
        &lt;/div&gt;
    {% else %}
        &lt;div class="form-group"&gt;
            {{ field.label(class=label_class) }}
            {{ field(class=field_class) }}
        &lt;/div&gt;
    {% endif %}
    
    {% if field.errors %}
        {% for error in field.errors %}
            &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
        {% endfor %}
    {% endif %}
{% endmacro %}</code></pre>
            
            <p>Then use it like this:</p>
            
            <pre><code>{{ render_field(form.name, theme='compact') }}</code></pre>
        </section>
        
        <section>
            <h2>Best Practices for Form Macros</h2>
            
            <ul>
                <li><strong>Single Responsibility</strong>: Each macro should do one thing well</li>
                <li><strong>Appropriate Defaults</strong>: Provide sensible defaults for parameters</li>
                <li><strong>Clear Documentation</strong>: Include comments to explain complex macros</li>
                <li><strong>Consistent Naming</strong>: Use a naming convention for your macros</li>
                <li><strong>Parameterization</strong>: Allow customization through parameters</li>
                <li><strong>Error Handling</strong>: Always handle errors gracefully</li>
                <li><strong>Accessibility</strong>: Ensure your macros produce accessible HTML</li>
            </ul>
            
            <h3>Organization Tips</h3>
            <p>As your macro library grows, consider these organizational strategies:</p>
            
            <ul>
                <li>Group related macros together</li>
                <li>Add comments to separate sections</li>
                <li>Include examples in comments</li>
                <li>Use comments to document parameters</li>
            </ul>
            
            <pre><code>{# 
    Basic Field Macros
    ------------------
    These macros handle the rendering of basic form fields.
    
    Parameters:
    - field: The WTForms field object
    - label_class: CSS classes for the label
    - field_class: CSS classes for the field
#}

{% macro render_field(field, label_class='', field_class='form-control') %}
    &lt;div class="form-group"&gt;
        {{ field.label(class=label_class) }}
        {{ field(class=field_class) }}
        
        {% if field.errors %}
            {% for error in field.errors %}
                &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
            {% endfor %}
        {% endif %}
        
        {% if field.description %}
            &lt;small class="form-text text-muted"&gt;{{ field.description }}&lt;/small&gt;
        {% endif %}
    &lt;/div&gt;
{% endmacro %}</code></pre>
        </section>
        
        <section>
            <h2>Conclusion</h2>
            <p>Form macros represent a best practice in Flask template development. They bring DRY principles to your frontend code, creating a more maintainable, consistent application. Start with simple field rendering macros and gradually expand to more complex patterns as your application grows.</p>
            
            <p>Remember to structure your macros thoughtfully - each should do one thing well, accept parameters for flexibility, and use clear, descriptive names. With well-designed form macros, you'll spend less time writing repetitive HTML and more time building application features.</p>
            
            <p>Form macros might seem like a small detail, but they make a significant impact on both the development experience and the quality of your final application. They're like compound interest - the investment pays increasing dividends over the lifetime of your project.</p>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Python Web Development Tutorials</p>
    </footer>
</body>
</html>
            
            <p>The Python Flask form class might look like this:</p>
            
            <pre><code># app/forms/contact.py
from flask_wtf import FlaskForm
from wtforms import StringField, TextAreaField, SubmitField
from wtforms.validators import DataRequired, Email, Length

class ContactForm(FlaskForm):
    name = StringField('Name', validators=[DataRequired(), Length(min=2, max=50)])
    email = StringField('Email', validators=[DataRequired(), Email()])
    subject = StringField('Subject', validators=[DataRequired(), Length(max=100)])
    message = TextAreaField('Message', validators=[DataRequired(), Length(min=10, max=1000)])
    submit = SubmitField('Send Message')</code></pre>
            
            <p>And in your route:</p>
            
            <pre><code># app/routes.py
from flask import render_template, flash, redirect, url_for
from app.forms.contact import ContactForm

@app.route('/contact', methods=['GET', 'POST'])
def contact():
    form = ContactForm()
    if form.validate_on_submit():
        # Process form submission
        flash('Your message has been sent!')
        return redirect(url_for('index'))
    return render_template('contact.html', form=form)</code></pre>
        </section>

        <section>
            <h2>Specialized Form Macros</h2>
            <p>Beyond basic field rendering, you can create specialized macros for common form patterns:</p>
            
            <h3>Radio Button Groups</h3>
            <pre><code>{% macro render_radio_field(field, inline=False) %}
    &lt;fieldset class="mb-3"&gt;
        {% if field.label.text %}
            &lt;legend&gt;{{ field.label.text }}&lt;/legend&gt;
        {% endif %}
        
        {% for subfield in field %}
            &lt;div class="form-check {% if inline %}form-check-inline{% endif %}"&gt;
                {{ subfield(class="form-check-input") }}
                {{ subfield.label(class="form-check-label") }}
            &lt;/div&gt;
        {% endfor %}
        
        {% if field.errors %}
            {% for error in field.errors %}
                &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
            {% endfor %}
        {% endif %}
        
        {% if field.description %}
            &lt;small class="form-text text-muted"&gt;{{ field.description }}&lt;/small&gt;
        {% endif %}
    &lt;/fieldset&gt;
{% endmacro %}</code></pre>
            
            <h3>Dropdown Selects</h3>
            <pre><code>{% macro render_select_field(field) %}
    &lt;div class="form-group"&gt;
        {{ field.label }}
        {{ field(class="form-select") }}
        
        {% if field.errors %}
            {% for error in field.errors %}
                &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
            {% endfor %}
        {% endif %}
        
        {% if field.description %}
            &lt;small class="form-text text-muted"&gt;{{ field.description }}&lt;/small&gt;
        {% endif %}
    &lt;/div&gt;
{% endmacro %}</code></pre>
            
            <h3>File Upload Fields</h3>
            <pre><code>{% macro render_file_field(field) %}
    &lt;div class="form-group"&gt;
        {{ field.label }}
        {{ field(class="form-control") }}
        
        {% if field.errors %}
            {% for error in field.errors %}
                &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
            {% endfor %}
        {% endif %}
        
        {% if field.description %}
            &lt;small class="form-text text-muted"&gt;{{ field.description }}&lt;/small&gt;
        {% endif %}
    &lt;/div&gt;
{% endmacro %}</code></pre>
            
            <p>Using these macros is as simple as importing them and calling them in your templates:</p>
            
            <pre><code>{# app/templates/product.html #}
{% extends 'base.html' %}
{% from 'macros/forms.html' import render_field, render_radio_field, render_file_field, render_submit %}

{% block content %}
    &lt;h2&gt;Add Product&lt;/h2&gt;
    
    &lt;form method="post" enctype="multipart/form-data" novalidate&gt;
        {{ form.hidden_tag() }}
        
        {{ render_field(form.name) }}
        {{ render_field(form.price) }}
        {{ render_radio_field(form.category, inline=True) }}
        {{ render_file_field(form.image) }}
        {{ render_field(form.description) }}
        {{ render_submit(form.submit) }}
    &lt;/form&gt;
{% endblock %}</code></pre>
        </section>

        <section>
            <h2>Advanced Form Macros</h2>
            <p>As your applications grow more complex, you can create more sophisticated macros for advanced form patterns:</p>
            
            <h3>Address Fields Macro</h3>
            <p>This macro represents a common form pattern - collecting an address:</p>
            
            <pre><code>{% macro render_address_fields(form_prefix, country_choices, required=True) %}
    &lt;div class="address-fields"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-12"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="{{ form_prefix }}_street"&gt;Street Address{% if required %} *{% endif %}&lt;/label&gt;
                    &lt;input type="text" 
                           id="{{ form_prefix }}_street" 
                           name="{{ form_prefix }}_street" 
                           class="form-control" 
                           {% if required %}required{% endif %}&gt;
                    &lt;div class="invalid-feedback"&gt;&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="row"&gt;
            &lt;div class="col-md-6"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="{{ form_prefix }}_city"&gt;City{% if required %} *{% endif %}&lt;/label&gt;
                    &lt;input type="text" 
                           id="{{ form_prefix }}_city" 
                           name="{{ form_prefix }}_city" 
                           class="form-control" 
                           {% if required %}required{% endif %}&gt;
                    &lt;div class="invalid-feedback"&gt;&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-6"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="{{ form_prefix }}_state"&gt;State/Province{% if required %} *{% endif %}&lt;/label&gt;
                    &lt;input type="text" 
                           id="{{ form_prefix }}_state" 
                           name="{{ form_prefix }}_state" 
                           class="form-control" 
                           {% if required %}required{% endif %}&gt;
                    &lt;div class="invalid-feedback"&gt;&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="row"&gt;
            &lt;div class="col-md-6"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="{{ form_prefix }}_zip"&gt;ZIP/Postal Code{% if required %} *{% endif %}&lt;/label&gt;
                    &lt;input type="text" 
                           id="{{ form_prefix }}_zip" 
                           name="{{ form_prefix }}_zip" 
                           class="form-control" 
                           {% if required %}required{% endif %}&gt;
                    &lt;div class="invalid-feedback"&gt;&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-6"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label for="{{ form_prefix }}_country"&gt;Country{% if required %} *{% endif %}&lt;/label&gt;
                    &lt;select id="{{ form_prefix }}_country" 
                            name="{{ form_prefix }}_country" 
                            class="form-select" 
                            {% if required %}required{% endif %}&gt;
                        &lt;option value=""&gt;Select a country&lt;/option&gt;
                        {% for code, name in country_choices %}
                            &lt;option value="{{ code }}"&gt;{{ name }}&lt;/option&gt;
                        {% endfor %}
                    &lt;/select&gt;
                    &lt;div class="invalid-feedback"&gt;&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
{% endmacro %}</code></pre>
            
            <p>Using this macro in a template:</p>
            
            <pre><code>{% from 'macros/forms.html' import render_address_fields %}

&lt;h3&gt;Shipping Address&lt;/h3&gt;
{{ render_address_fields('shipping', countries, required=True) }}

&lt;h3&gt;Billing Address&lt;/h3&gt;
&lt;div class="form-check mb-3"&gt;
    &lt;input class="form-check-input" type="checkbox" id="same_as_shipping" name="same_as_shipping"&gt;
    &lt;label class="form-check-label" for="same_as_shipping"&gt;
        Same as shipping address
    &lt;/label&gt;
&lt;/div&gt;

&lt;div id="billing_address_container"&gt;
    {{ render_address_fields('billing', countries, required=True) }}
&lt;/div&gt;</code></pre>
            
            <h3>Repeatable Field Groups</h3>
            <p>For forms that need dynamic addition of field groups (like adding multiple education entries in a resume):</p>
            
            <pre><code>{% macro repeatable_field_group(legend, template_id, container_id, min_count=1, max_count=10) %}
    &lt;fieldset&gt;
        &lt;legend&gt;{{ legend }}&lt;/legend&gt;
        
        &lt;div id="{{ container_id }}"&gt;
            &lt;!-- Dynamic field groups will be added here --&gt;
        &lt;/div&gt;
        
        &lt;button type="button" 
                class="btn btn-sm btn-secondary mt-2 add-field-group" 
                data-template="{{ template_id }}" 
                data-container="{{ container_id }}"
                data-max="{{ max_count }}"&gt;
            Add Another
        &lt;/button&gt;
    &lt;/fieldset&gt;
    
    &lt;!-- Template for the repeatable field group --&gt;
    &lt;template id="{{ template_id }}"&gt;
        &lt;div class="repeatable-group card mb-3"&gt;
            &lt;div class="card-body"&gt;
                {{ caller() }}
                
                &lt;button type="button" class="btn btn-sm btn-danger remove-field-group"&gt;
                    Remove
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/template&gt;
    
    &lt;script&gt;
        document.addEventListener('DOMContentLoaded', function() {
            // Add initial field groups
            const container = document.getElementById('{{ container_id }}');
            const template = document.getElementById('{{ template_id }}');
            const addButton = document.querySelector('[data-template="{{ template_id }}"]');
            
            // Add minimum number of field groups
            for (let i = 0; i < {{ min_count }}; i++) {
                addFieldGroup();
            }
            
            // Set up add button event
            addButton.addEventListener('click', function() {
                const maxCount = parseInt(this.dataset.max);
                const currentCount = container.querySelectorAll('.repeatable-group').length;
                
                if (currentCount < maxCount) {
                    addFieldGroup();
                }
                
                // Disable button if max reached
                if (currentCount + 1 >= maxCount) {
                    this.disabled = true;
                }
            });
            
            // Setup removal event delegation
            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-field-group')) {
                    const group = e.target.closest('.repeatable-group');
                    const currentCount = container.querySelectorAll('.repeatable-group').length;
                    
                    // Don't remove if it's the last one and we need at least one
                    if (currentCount > {{ min_count }}) {
                        group.remove();
                        
                        // Re-enable add button if it was disabled
                        addButton.disabled = false;
                    }
                }
            });
            
            function addFieldGroup() {
                // Clone the template content
                const content = template.content.cloneNode(true);
                
                // Update IDs and names with a unique index
                const index = Date.now(); // Use timestamp for unique IDs
                const elements = content.querySelectorAll('[id], [name]');
                
                elements.forEach(el => {
                    if (el.hasAttribute('id')) {
                        el.id = el.id.replace('INDEX', index);
                    }
                    
                    if (el.hasAttribute('name')) {
                        el.name = el.name.replace('INDEX', index);
                    }
                    
                    // Update any labels that reference the fields
                    if (el.hasAttribute('id')) {
                        const label = content.querySelector(`label[for="${el.id.replace(index, 'INDEX')}"]`);
                        if (label) {
                            label.setAttribute('for', el.id);
                        }
                    }
                });
                
                // Add to container
                container.appendChild(content);
            }
        });
    &lt;/script&gt;
{% endmacro %}</code></pre>
            
            <p>Using this macro for a repeatable education history section:</p>
            
            <pre><code>{% from 'macros/forms.html' import repeatable_field_group %}

{% call repeatable_field_group('Education History', 'education-template', 'education-container', min_count=1, max_count=5) %}
    &lt;div class="row"&gt;
        &lt;div class="col-md-6"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="education_INDEX_institution"&gt;Institution&lt;/label&gt;
                &lt;input type="text" class="form-control" id="education_INDEX_institution" name="education[INDEX][institution]" required&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="col-md-6"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="education_INDEX_degree"&gt;Degree&lt;/label&gt;
                &lt;input type="text" class="form-control" id="education_INDEX_degree" name="education[INDEX][degree]" required&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;div class="row mt-2"&gt;
        &lt;div class="col-md-6"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="education_INDEX_start_date"&gt;Start Date&lt;/label&gt;
                &lt;input type="date" class="form-control" id="education_INDEX_start_date" name="education[INDEX][start_date]" required&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="col-md-6"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="education_INDEX_end_date"&gt;End Date&lt;/label&gt;
                &lt;input type="date" class="form-control" id="education_INDEX_end_date" name="education[INDEX][end_date]"&gt;
                
                &lt;div class="form-check mt-2"&gt;
                    &lt;input class="form-check-input" type="checkbox" id="education_INDEX_current" name="education[INDEX][current]"&gt;
                    &lt;label class="form-check-label" for="education_INDEX_current"&gt;
                        Currently studying here
                    &lt;/label&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
{% endcall %}</code></pre>
        </section>

        <section>
            <h2>Real-World Example: Multi-Step Checkout Form</h2>
            <p>Let's see a practical example of how form macros can be used to build a complex checkout flow:</p>
            
            <pre><code>&lt;!-- app/templates/checkout/index.html --&gt;
{% extends 'base.html' %}
{% from 'macros/forms.html' import render_field, render_submit, render_radio_field, render_address_fields %}

{% block title %}Checkout{% endblock %}

{% block content %}
    &lt;div class="row"&gt;
        &lt;div class="col-md-8"&gt;
            &lt;h2&gt;Checkout&lt;/h2&gt;
            
            &lt;div class="checkout-progress mb-4"&gt;
                &lt;div class="progress"&gt;
                    &lt;div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"&gt;Step 1 of 4&lt;/div&gt;
                &lt;/div&gt;
                &lt;div class="d-flex justify-content-between mt-2"&gt;
                    &lt;span class="step active"&gt;Customer Info&lt;/span&gt;
                    &lt;span class="step"&gt;Shipping&lt;/span&gt;
                    &lt;span class="step"&gt;Payment&lt;/span&gt;
                    &lt;span class="step"&gt;Review&lt;/span&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;form id="checkout-form" method="post" novalidate&gt;
                {{ form.hidden_tag() }}
                
                &lt;!-- Step 1: Customer Information --&gt;
                &lt;section id="step-1" class="checkout-step active"&gt;
                    &lt;h3&gt;Customer Information&lt;/h3&gt;
                    
                    &lt;div class="row"&gt;
                        &lt;div class="col-md-6"&gt;
                            {{ render_field(form.first_name) }}
                        &lt;/div&gt;
                        &lt;div class="col-md-6"&gt;
                            {{ render_field(form.last_name) }}
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    {{ render_field(form.email) }}
                    {{ render_field(form.phone) }}
                    
                    {% if not current_user.is_authenticated %}
                        &lt;div class="form-check mb-3"&gt;
                            {{ form.create_account(class="form-check-input") }}
                            {{ form.create_account.label(class="form-check-label") }}
                            &lt;div class="form-text"&gt;Create an account to track your order and save your information for next time.&lt;/div&gt;
                        &lt;/div&gt;
                        
                        &lt;div id="password-fields" style="display: none;"&gt;
                            {{ render_field(form.password) }}
                            {{ render_field(form.confirm_password) }}
                        &lt;/div&gt;
                    {% endif %}
                    
                    &lt;div class="mt-3"&gt;
                        &lt;button type="button" class="btn btn-primary next-step"&gt;Continue to Shipping&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/section&gt;
                
                &lt;!-- Step 2: Shipping --&gt;
                &lt;section id="step-2" class="checkout-step"&gt;
                    &lt;h3&gt;Shipping Information&lt;/h3&gt;
                    
                    &lt;h4&gt;Shipping Address&lt;/h4&gt;
                    {{ render_address_fields('shipping', countries) }}
                    
                    &lt;h4 class="mt-4"&gt;Shipping Method&lt;/h4&gt;
                    {{ render_radio_field(form.shipping_method) }}
                    
                    &lt;div class="mt-3"&gt;
                        &lt;button type="button" class="btn btn-secondary prev-step"&gt;Back&lt;/button&gt;
                        &lt;button type="button" class="btn btn-primary next-step"&gt;Continue to Payment&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/section&gt;
                
                &lt;!-- Step 3: Payment --&gt;
                &lt;section id="step-3" class="checkout-step"&gt;
                    &lt;h3&gt;Payment Information&lt;/h3&gt;
                    
                    &lt;h4&gt;Billing Address&lt;/h4&gt;
                    &lt;div class="form-check mb-3"&gt;
                        {{ form.same_as_shipping(class="form-check-input") }}
                        {{ form.same_as_shipping.label(class="form-check-label") }}
                    &lt;/div&gt;
                    
                    &lt;div id="billing-address-container"&gt;
                        {{ render_address_fields('billing', countries) }}
                    &lt;/div&gt;
                    
                    &lt;h4 class="mt-4"&gt;Payment Method&lt;/h4&gt;
                    {{ render_radio_field(form.payment_method) }}
                    
                    &lt;div id="credit-card-fields" class="payment-fields"&gt;
                        &lt;div class="row"&gt;
                            &lt;div class="col-md-6"&gt;
                                {{ render_field(form.card_number) }}
                            &lt;/div&gt;
                            &lt;div class="col-md-6"&gt;
                                {{ render_field(form.card_name) }}
                            &lt;/div&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="row"&gt;
                            &lt;div class="col-md-6"&gt;
                                &lt;div class="row"&gt;
                                    &lt;div class="col-6"&gt;
                                        {{ render_field(form.card_expiry_month) }}
                                    &lt;/div&gt;
                                    &lt;div class="col-6"&gt;
                                        {{ render_field(form.card_expiry_year) }}
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-6"&gt;
                                {{ render_field(form.card_cvv) }}
                            &lt;/div&
                            {% endblock %}</code></pre>
            
                            <p>This complex multi-step checkout form becomes much more manageable with form macros. Each component is reusable and consistent, dramatically reducing the amount of HTML you need to write and maintain.</p>
                        </section>
                
                        <section>
                            <h2>JavaScript Integration with Form Macros</h2>
                            <p>Form macros work excellently with JavaScript to create dynamic interactions. Here's an example of JavaScript that might accompany our checkout form:</p>
                            
                            <pre><code>// app/static/js/checkout.js
                document.addEventListener('DOMContentLoaded', function() {
                    // Step navigation
                    const steps = document.querySelectorAll('.checkout-step');
                    const nextButtons = document.querySelectorAll('.next-step');
                    const prevButtons = document.querySelectorAll('.prev-step');
                    const progressBar = document.querySelector('.progress-bar');
                    
                    let currentStepIndex = 0;
                    
                    function showStep(index) {
                        // Hide all steps
                        steps.forEach(step => {
                            step.classList.remove('active');
                        });
                        
                        // Show current step
                        steps[index].classList.add('active');
                        
                        // Update progress bar
                        const progress = ((index + 1) / steps.length) * 100;
                        progressBar.style.width = `${progress}%`;
                        progressBar.setAttribute('aria-valuenow', progress);
                        progressBar.textContent = `Step ${index + 1} of ${steps.length}`;
                        
                        // Update step indicators
                        document.querySelectorAll('.step').forEach((indicator, i) => {
                            if (i === index) {
                                indicator.classList.add('active');
                            } else {
                                indicator.classList.remove('active');
                            }
                        });
                    }
                    
                    // Setup next buttons
                    nextButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            // You might add validation here
                            if (validateStep(currentStepIndex)) {
                                currentStepIndex++;
                                showStep(currentStepIndex);
                                window.scrollTo(0, 0);
                            }
                        });
                    });
                    
                    // Setup previous buttons
                    prevButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            currentStepIndex--;
                            showStep(currentStepIndex);
                            window.scrollTo(0, 0);
                        });
                    });
                    
                    // Function to validate current step
                    function validateStep(stepIndex) {
                        // Add validation logic here
                        return true;
                    }
                    
                    // Payment method toggle
                    const paymentMethodRadios = document.querySelectorAll('input[name="payment_method"]');
                    const paymentFields = document.querySelectorAll('.payment-fields');
                    
                    paymentMethodRadios.forEach(radio => {
                        radio.addEventListener('change', () => {
                            paymentFields.forEach(field => {
                                field.style.display = 'none';
                            });
                            
                            const value = radio.value;
                            document.getElementById(`${value}-fields`).style.display = 'block';
                        });
                    });
                    
                    // Same as shipping checkbox
                    const sameAsShippingCheckbox = document.getElementById('same_as_shipping');
                    const billingAddressContainer = document.getElementById('billing-address-container');
                    
                    sameAsShippingCheckbox.addEventListener('change', () => {
                        if (sameAsShippingCheckbox.checked) {
                            billingAddressContainer.style.display = 'none';
                            
                            // Copy shipping address values to billing
                            document.querySelectorAll('[id^="shipping_"]').forEach(field => {
                                const billingId = field.id.replace('shipping_', 'billing_');
                                const billingField = document.getElementById(billingId);
                                
                                if (billingField) {
                                    billingField.value = field.value;
                                }
                            });
                        } else {
                            billingAddressContainer.style.display = 'block';
                        }
                    });
                    
                    // Create account checkbox
                    const createAccountCheckbox = document.getElementById('create_account');
                    const passwordFields = document.getElementById('password-fields');
                    
                    if (createAccountCheckbox) {
                        createAccountCheckbox.addEventListener('change', () => {
                            passwordFields.style.display = createAccountCheckbox.checked ? 'block' : 'none';
                        });
                    }
                });
                </code></pre>
                        </section>
                        
                        <section>
                            <h2>Benefits of Form Macros</h2>
                            <p>Using form macros in your Flask applications offers numerous benefits:</p>
                            
                            <ul>
                                <li><strong>Consistency</strong>: All forms across your application look and behave consistently</li>
                                <li><strong>Maintainability</strong>: Make changes in one place and they propagate everywhere</li>
                                <li><strong>Productivity</strong>: Write less HTML and focus more on application logic</li>
                                <li><strong>Flexibility</strong>: Accept parameters to customize behavior when needed</li>
                                <li><strong>Scalability</strong>: Handle complex form patterns with ease</li>
                            </ul>
                            
                            <p>Think of form macros as a design system for your forms - they establish standards and patterns that make development faster and more consistent.</p>
                            
                            <h3>Form Macros vs. Flask-WTF Fields</h3>
                            <p>It's important to understand that form macros work alongside Flask-WTF, not as a replacement. Flask-WTF handles:</p>
                            
                            <ul>
                                <li>Form definition and structure</li>
                                <li>Validation logic</li>
                                <li>CSRF protection</li>
                            </ul>
                            
                            <p>While form macros handle:</p>
                            
                            <ul>
                                <li>HTML rendering</li>
                                <li>Layout and styling</li>
                                <li>Error message display</li>
                                <li>Consistent UX patterns</li>
                            </ul>
                            
                            <p>This separation of concerns is powerful - your Python code handles the "what" (validation, structure) while your macros handle the "how" (presentation, interaction).</p>
                        </section>
                        
                        <section>
                            <h2>Form Macros in Complex Applications</h2>
                            <p>In larger applications, you might extend this concept further:</p>
                            
                            <h3>Macro Libraries</h3>
                            <p>Create separate macro files for different types of components:</p>
                            <ul>
                                <li><code>forms.html</code> - Basic form controls</li>
                                <li><code>layout.html</code> - Grid and structural macros</li>
                                <li><code>components.html</code> - Complex UI components</li>
                            </ul>
                            
                            <p>You could organize them in a folder structure like this:</p>
                            
                            <pre><code>app/
                ├── templates/
                │   ├── macros/
                │   │   ├── forms.html
                │   │   ├── layout.html
                │   │   ├── components.html
                │   │   └── ...
                │   ├── base.html
                │   └── ...
                </code></pre>
                            
                            <h3>Theme Support</h3>
                            <p>You can also parameterize your macros to support different visual themes:</p>
                            
                            <pre><code>{% macro render_field(field, theme='default', label_class='', field_class='form-control') %}
                    {% if theme == 'compact' %}
                        &lt;div class="form-group form-group-sm"&gt;
                            {{ field.label(class='form-label-sm ' + label_class) }}
                            {{ field(class='form-control-sm ' + field_class) }}
                        &lt;/div&gt;
                    {% elif theme == 'dark' %}
                        &lt;div class="form-group bg-dark text-light p-3 rounded"&gt;
                            {{ field.label(class='text-light ' + label_class) }}
                            {{ field(class='form-control bg-secondary text-light ' + field_class) }}
                        &lt;/div&gt;
                    {% else %}
                        &lt;div class="form-group"&gt;
                            {{ field.label(class=label_class) }}
                            {{ field(class=field_class) }}
                        &lt;/div&gt;
                    {% endif %}
                    
                    {% if field.errors %}
                        {% for error in field.errors %}
                            &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
                        {% endfor %}
                    {% endif %}
                {% endmacro %}</code></pre>
                            
                            <p>Then use it like this:</p>
                            
                            <pre><code>{{ render_field(form.name, theme='compact') }}</code></pre>
                        </section>
                        
                        <section>
                            <h2>Best Practices for Form Macros</h2>
                            
                            <ul>
                                <li><strong>Single Responsibility</strong>: Each macro should do one thing well</li>
                                <li><strong>Appropriate Defaults</strong>: Provide sensible defaults for parameters</li>
                                <li><strong>Clear Documentation</strong>: Include comments to explain complex macros</li>
                                <li><strong>Consistent Naming</strong>: Use a naming convention for your macros</li>
                                <li><strong>Parameterization</strong>: Allow customization through parameters</li>
                                <li><strong>Error Handling</strong>: Always handle errors gracefully</li>
                                <li><strong>Accessibility</strong>: Ensure your macros produce accessible HTML</li>
                            </ul>
                            
                            <h3>Organization Tips</h3>
                            <p>As your macro library grows, consider these organizational strategies:</p>
                            
                            <ul>
                                <li>Group related macros together</li>
                                <li>Add comments to separate sections</li>
                                <li>Include examples in comments</li>
                                <li>Use comments to document parameters</li>
                            </ul>
                            
                            <pre><code>{# 
                    Basic Field Macros
                    ------------------
                    These macros handle the rendering of basic form fields.
                    
                    Parameters:
                    - field: The WTForms field object
                    - label_class: CSS classes for the label
                    - field_class: CSS classes for the field
                #}
                
                {% macro render_field(field, label_class='', field_class='form-control') %}
                    &lt;div class="form-group"&gt;
                        {{ field.label(class=label_class) }}
                        {{ field(class=field_class) }}
                        
                        {% if field.errors %}
                            {% for error in field.errors %}
                                &lt;div class="invalid-feedback d-block"&gt;{{ error }}&lt;/div&gt;
                            {% endfor %}
                        {% endif %}
                        
                        {% if field.description %}
                            &lt;small class="form-text text-muted"&gt;{{ field.description }}&lt;/small&gt;
                        {% endif %}
                    &lt;/div&gt;
                {% endmacro %}</code></pre>
                        </section>
                        
                        <section>
                            <h2>Conclusion</h2>
                            <p>Form macros represent a best practice in Flask template development. They bring DRY principles to your frontend code, creating a more maintainable, consistent application. Start with simple field rendering macros and gradually expand to more complex patterns as your application grows.</p>
                            
                            <p>Remember to structure your macros thoughtfully - each should do one thing well, accept parameters for flexibility, and use clear, descriptive names. With well-designed form macros, you'll spend less time writing repetitive HTML and more time building application features.</p>
                            
                            <p>Form macros might seem like a small detail, but they make a significant impact on both the development experience and the quality of your final application. They're like compound interest - the investment pays increasing dividends over the lifetime of your project.</p>
                        </section>
                    </main>
                
                    <footer>
                        <p>&copy; 2025 Python Web Development Tutorials</p>
                    </footer>
                </body>
                </html>
